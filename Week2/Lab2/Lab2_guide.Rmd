---
title: "MA213 Basic Statistics and Probability - Lab2 Guide"
bibliography: references.bib
link-citations: true
output:
  pdf_document: default
  html_document:
    code_download: true 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## **Lab 2:** Data transformation

Data transformation is a crucial part in exploratory data analysis (EDA). EDA includes the processes of importing, cleaning, and visualizing data to uncover the patterns, relationships and hidden insights within the data.

In this lab, we will learn data processing and subsetting to see more insights from the data.

------------------------------------------------------------------------

## Learning Objectives

-   Use R for Data Management and Exploration: Utilize R to load, pre-process, and explore data through visualization and summarization techniques.
-   Classify and Analyze Variables: Categorize variables based on their types (e.g., numerical/categorical, continuous/discrete, ordinal), assess their association (positive, negative, or independent), and determine which make sense as explanatory vs. response variables.

------------------------------------------------------------------------

## Load packages for Data

If you didn't install `tidyverse` package

```{r eval=FALSE}
install.packages("tidyverse")
```

Load package

```{r, echo=TRUE}
library(tidyverse)
```

## **New York Air Quality Data**

Daily air quality measurements in New York, May to September 1973 stored within a data frame with 153 observations on 6 variables. It is obtained from the New York State Department of Conservation (ozone data) and the National Weather Service (meteorological data). It is cited by @chambers2018graphical.

You can find the details fo the data description [here](https://stat.ethz.ch/R-manual/R-devel/library/datasets/html/airquality.html).

## Import the Data

You can use `airquality` object from base R data. You can also `airquality.csv` file where the data is stored as a comma separated value (CSV) file. Each row holds information for a single observation.

Import the data from `airquality.csv` and show first 6 rows to see how this data is organized.

```{r, echo=TRUE}
df = read.csv("airquality.csv")
```

## `glimpse()` to take a quick peek at your data

```{r, echo=TRUE}

glimpse(df)

```

## To view the names of the variables

```{r, echo=TRUE}

names(df)

```

## To view the first 6 rows

```{r, echo=TRUE}

head(df)

```

## The pipe operator

`dplyr` (one of data packages in `tidyverse`) provides the `%>%` operator from magrittr. `x %>% f(y)` turns into `f(x, y)` so the result from one step is then “piped” into the next step.

`df %>% filter(Month==5)` means "Select all rows with May"

```{r, echo=TRUE, eval=TRUE}
df %>% filter(Month==5)

```

## The pipe operator can be added

You can use the pipe to rewrite multiple operations that you can read left-to-right, top-to-bottom (reading the pipe operator as “then”) (`%>%` and `|>` are equivalent)

```{r, echo=TRUE, eval=TRUE}
df |> 
  select(Ozone, Wind, Month) |>
  filter(Month==5)

# 
```

## `Dplyr` data manipulation functions

-   Rows:

    -   [`filter()`](https://dplyr.tidyverse.org/reference/filter.html) chooses rows based on column values.

    -   [`slice()`](https://dplyr.tidyverse.org/reference/slice.html) chooses rows based on location.

    -   [`arrange()`](https://dplyr.tidyverse.org/reference/arrange.html) changes the order of the rows.

-   Columns:

    -   [`select()`](https://dplyr.tidyverse.org/reference/select.html) changes whether or not a column is included.

    -   [`rename()`](https://dplyr.tidyverse.org/reference/rename.html) changes the name of columns.

    -   [`mutate()`](https://dplyr.tidyverse.org/reference/mutate.html) changes the values of columns and creates new columns.

    -   [`relocate()`](https://dplyr.tidyverse.org/reference/relocate.html) changes the order of the columns.

-   Groups of rows:

    -   [`summarise()`](https://dplyr.tidyverse.org/reference/summarise.html) collapses a group into a single row.

## Some useful resources

<https://openintrostat.github.io/oilabs-tidy/02_intro_to_data/intro_to_data.html>

<https://dplyr.tidyverse.org/articles/dplyr.html>

<https://rstudio.github.io/cheatsheets/html/data-transformation.html>

## Creating new column using `Dplyr`

You can create new columns or modify existing ones using the `mutate()` function.

For example, to create a new column that categorizes temperature:

```{r, echo=TRUE}
df <- df %>%
  mutate(Temp_Category = ifelse(Temp > 80, "High", "Moderate")) # if Temp>80 -> "High" otherwise "Moderate"

head(df)
```

## Contingency Table using `dplyr`

A contingency table displays the frequency distribution of variables. You can create contingency tables using `dplyr` in combination with `tidyr`.

For example, to create a contingency table of Month vs. Ozone_Level:

```{r, echo=TRUE}
df <- df %>%
  mutate(Ozone_Level = ifelse(Ozone > median(Ozone, na.rm=TRUE), "High", "Low"))

contingency_table <- df %>%
  group_by(Month, Ozone_Level) %>%
  summarise(Count = n()) %>%
  pivot_wider(names_from = Ozone_Level, values_from = Count)

print(contingency_table)
```

## Contingency Table with new categorized variable

You can categorize `solar.R` by

```         
Solar.R <= 115       : Low
115< Solar.R <= 185  : Medium
258< Solar.R         : High
```

Create a contingency table for categorized `solar.R` vs `Ozone_level`

```{r, echo=TRUE}
 contingency_table2 <- df %>%
  mutate(solar_cat = case_when(
    Solar.R <= 115 ~ "Low",
    Solar.R > 115 & Solar.R <= 185 ~ "Medium",
    Solar.R > 258 ~ "High"
  )) %>%
  group_by(solar_cat, Ozone_Level) %>%
  summarise(Count = n()) %>%
  pivot_wider(
    names_from = Ozone_Level,
    values_from = Count
  )
 
 
 print(contingency_table2)
```
